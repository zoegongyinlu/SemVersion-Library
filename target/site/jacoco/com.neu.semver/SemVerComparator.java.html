<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SemVerComparator.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">SemVer Java Library</a> &gt; <a href="index.source.html" class="el_package">com.neu.semver</a> &gt; <span class="el_source">SemVerComparator.java</span></div><h1>SemVerComparator.java</h1><pre class="source lang-java linenums">package com.neu.semver;

import java.io.Serializable;
import java.util.Comparator;

/**
 * Comparator implementing SemVer 2.0.0 precedence rules.
 * @author Yinlu Gong
 * @version 0.1.0
 */
public final class SemVerComparator implements
    Comparator&lt;SemVer&gt;, Serializable {

    /** Serial version UID for serialization compatibility. */
    private static final long serialVersionUID = 1L;

    /** Singleton instance. */
<span class="fc" id="L18">    public static final SemVerComparator INSTANCE = new SemVerComparator();</span>

    /** Private constructor to prevent instantiation. */
    private SemVerComparator() { }

    /**
     * Compares two SemVer objects according to SemVer 2.0.0 precedence rules.
     * This static method provides a clean interface that avoids Law of Demeter
     * violations by not requiring direct access to the singleton instance.
     * The comparison follows these precedence rules:
     * 1. Major version numbers are compared first
     * 2. If major versions are equal, minor versions are compared
     * 3. If minor versions are equal, patch versions are compared
     * 4. If patch versions are equal, prerelease identifiers are compared
     * 5. Build metadata is ignored in precedence calculations
     * For prerelease comparison:
     * - A version without prerelease has higher precedence than
     * one with prerelease
     * - Prerelease identifiers are compared dot-separated
     * - Numeric identifiers have lower precedence than non-numeric identifiers
     * - When both are numeric, they are compared numerically
     * - When both are non-numeric, they are compared lexicographically
     *
     * @param version1 the first SemVer object to compare
     * @param version2 the second SemVer object to compare
     * @return a negative integer, zero, or a positive integer as the first
     *         argument is less than, equal to, or greater than the second
     * @throws IllegalArgumentException if either version is null
     */
    public static int compareVersions(
        final SemVer version1,
        final SemVer version2
    ) {
<span class="pc bpc" id="L51" title="2 of 4 branches missed.">        if (</span>
            version1 == null
                || version2 == null) {
<span class="nc" id="L54">            throw new IllegalArgumentException(</span>
                &quot;Versions must not be null&quot;
            );
        }
<span class="fc" id="L58">        return INSTANCE.compare(version1, version2);</span>
    }

    @Override
    public int compare(final SemVer version1, final SemVer version2) {
<span class="fc" id="L63">        int result = Integer.compare(version1.getMajor(), version2.getMajor());</span>
<span class="fc bfc" id="L64" title="All 2 branches covered.">        if (result == 0) {</span>
<span class="fc" id="L65">            result = Integer.compare(version1.getMinor(), version2.getMinor());</span>
        }
<span class="fc bfc" id="L67" title="All 2 branches covered.">        if (result == 0) {</span>
<span class="fc" id="L68">            result = Integer.compare(version1.getPatch(), version2.getPatch());</span>
        }
<span class="fc bfc" id="L70" title="All 2 branches covered.">        if (result == 0) {</span>
<span class="fc" id="L71">            result = comparePrerelease(</span>
<span class="fc" id="L72">                version1.getPrerelease(),</span>
<span class="fc" id="L73">                version2.getPrerelease());</span>
        }
<span class="fc" id="L75">        return result;</span>
    }

    /**
     * Compares prerelease identifiers according to SemVer 2.0.0 rules.
     *
     * @param prerelease1 first prerelease identifier
     * @param prerelease2 second prerelease identifier
     * @return comparison result
     */
    private static int comparePrerelease(
        final String prerelease1,
        final String prerelease2) {
        int result;
<span class="fc bfc" id="L89" title="All 4 branches covered.">        if (prerelease1 == null &amp;&amp; prerelease2 == null) {</span>
<span class="fc" id="L90">            result = 0;</span>
<span class="fc bfc" id="L91" title="All 2 branches covered.">        } else if (prerelease1 == null) {</span>
<span class="fc" id="L92">            result = 1;</span>
<span class="fc bfc" id="L93" title="All 2 branches covered.">        } else if (prerelease2 == null) {</span>
<span class="fc" id="L94">            result = -1;</span>
        } else {
<span class="fc" id="L96">            final String[] identifiers1 = prerelease1.split(&quot;\\.&quot;);</span>
<span class="fc" id="L97">            final String[] identifiers2 = prerelease2.split(&quot;\\.&quot;);</span>
<span class="fc" id="L98">            final int minLength = Math.min(</span>
                identifiers1.length,
                identifiers2.length
            );
<span class="fc" id="L102">            result = 0;</span>
<span class="fc bfc" id="L103" title="All 4 branches covered.">            for (int i = 0; i &lt; minLength &amp;&amp; result == 0; i++) {</span>
<span class="fc" id="L104">                result = compareIdentifier(</span>
                    identifiers1[i],
                    identifiers2[i]
                );
            }
<span class="fc bfc" id="L109" title="All 2 branches covered.">            if (result == 0) {</span>
<span class="fc" id="L110">                result = Integer.compare(</span>
                    identifiers1.length,
                    identifiers2.length
                );
            }
        }
<span class="fc" id="L116">        return result;</span>
    }

    /**
     * Compares two prerelease identifiers.
     * Numeric identifiers have lower
     * precedence than non-numeric identifiers.
     *
     * @param identifier1 first identifier
     * @param identifier2 second identifier
     * @return comparison result
     */
    private static int compareIdentifier(
        final String identifier1,
        final String identifier2
    ) {
<span class="fc" id="L132">        final boolean isNumeric1 = isNumeric(identifier1);</span>
<span class="fc" id="L133">        final boolean isNumeric2 = isNumeric(identifier2);</span>
        int result;
<span class="fc bfc" id="L135" title="All 4 branches covered.">        if (isNumeric1 &amp;&amp; isNumeric2) {</span>
<span class="fc" id="L136">            result = Integer.compare(</span>
<span class="fc" id="L137">                Integer.parseInt(identifier1),</span>
<span class="fc" id="L138">                Integer.parseInt(identifier2)</span>
            );
<span class="fc bfc" id="L140" title="All 2 branches covered.">        } else if (isNumeric1) {</span>
<span class="fc" id="L141">            result = -1;</span>
<span class="fc bfc" id="L142" title="All 2 branches covered.">        } else if (isNumeric2) {</span>
<span class="fc" id="L143">            result = 1;</span>
        } else {
<span class="fc" id="L145">            result = identifier1.compareTo(identifier2);</span>
        }
<span class="fc" id="L147">        return result;</span>
    }

    /**
     * Determines whether a string is a valid non-negative integer.
     *
     * @param value value to test
     * @return true if numeric, false otherwise
     */
    private static boolean isNumeric(final String value) {
<span class="pc bpc" id="L157" title="2 of 4 branches missed.">        boolean result = value != null &amp;&amp; !value.isEmpty();</span>
<span class="pc bpc" id="L158" title="1 of 2 branches missed.">        if (result) {</span>
            try {
<span class="fc" id="L160">                Integer.parseInt(value);</span>
<span class="fc" id="L161">            } catch (NumberFormatException e) {</span>
<span class="fc" id="L162">                result = false;</span>
<span class="fc" id="L163">            }</span>
        }
<span class="fc" id="L165">        return result;</span>
    }
}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>